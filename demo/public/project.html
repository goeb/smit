
<html>
    <head>
        <title>Project configuration</title>
        <link rel="stylesheet" type="text/css" href="/public/style.css">
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
        <script src="/public/smit.js"></script>
        <script>

            function addMoreProperties(n) {
                // add 3 more properties on page
                for (var i=0; i<n; i++) addProperty('', '', '', '');
            }
            function addMorePredefinedViews(n) {
                for (var i=0; i<n; i++) addPredefinedViews('', '');
            }
            function addPredefinedViews(text, url) {
                var views = document.getElementById('sm_predefined_views');
                var n = views.childNodes.length;
                // add predefined view n+1
                n = n + 1;
                var viewn = document.createElement('div');
                viewn.id = 'predefined_view_' + n;

                // input boxes for this property
                var i = document.createTextNode('#' + n + ' ');
                viewn.appendChild(i);

                i = document.createElement('input');
                i.name = 'predefined_view_' + n + '_text';
                i.size = 30;
                i.value = text;
                i.placeholder = "Description of the predefined view"
                viewn.appendChild(i);

                i = document.createElement('input');
                i.name = 'predefined_view_' + n + '_url';
                i.size = 30;
                i.value = url;
                i.placeholder = "eg: sort=-mtime&filterin=status:open"
                viewn.appendChild(i);

                views.appendChild(viewn);
            }
            function addProperty(name, label, type, opts) {
                var properties = document.getElementById('sm_properties');
                var n = properties.childNodes.length;
                // add property n+1
                n = n + 1;
                var fieldn = document.createElement('div');
                fieldn.id = 'property' + n;

                // input boxes for this property
                var i = document.createTextNode('#' + n + ' ');
                fieldn.appendChild(i);

                i = document.createElement('input');
                i.name = 'property' + n + '_name';
                i.size = 15;
                i.value = name;
                i.pattern = "[a-zA-Z_0-9]+"
                i.placeholder = "logical_name"
                i.title = "Allowed characters: letters, digits, underscore"
                if (type == 'reserved') i.disabled = true;
                fieldn.appendChild(i);

                i = document.createElement('input');
                i.name = 'property' + n + '_label';
                i.size = 20;
                i.value = label;
                i.placeholder = "Label that will be displayed";
                i.title = "Label that will be displayed";
                fieldn.appendChild(i);

                if (type == 'reserved') {
                    i = document.createElement('span');
                    i.innerHTML = 'reserved';
                    fieldn.appendChild(i);
                } else {
                    i = document.createElement('select');
                    i.name = 'property' + n + '_type';
                    i.className = "updatable";
                    i.onchange = fupdateThis;
                    var options = ['text', 'list', 'multilist', 'user'];
                    for (index=0; index<options.length; index++) {
                        opt = document.createElement('option');
                        opt.innerHTML = options[index];
                        if (type == opt.innerHTML) opt.selected = 1;
                        i.appendChild(opt);
                    }
                    fieldn.appendChild(i);
                    fupdate(i, opts);
                }
                properties.appendChild(fieldn);

            }
            function fupdateThis() { fupdate(this); }
            function fupdate(item, value) {
                //alert(item.value);
                if (item.value == "text") show_size_input(item.parentNode, value);
                else if (item.value == "list") show_list_input(item.parentNode, value);
                else if (item.value == "multilist") show_list_input(item.parentNode, value);
                else if (item.value == "user") show_user_input(item.parentNode);
            }
            function show_size_input(item, value) {
                // hide extra details
                x = document.getElementById(item.id + '_opt');
                if (x) item.removeChild(x);

                x = document.getElementById(item.id + '_help');
                if (x) item.removeChild(x);
            }
            function show_list_input(item, value) {
                x = document.getElementById(item.id + '_opt');
                if (x) item.removeChild(x);
                i = document.createElement('textarea')
                i.name = item.id + '_opt';
                i.id = i.name;
                i.className = 'tke_fieldconfig';
                i.rows = 4;
                i.cols = 20;
                if (value) i.value = value;
                item.appendChild(i);

                x = document.getElementById(item.id + '_help');
                if (x) item.removeChild(x);
                t = document.createElement('span');
                t.innerHTML = "(one value per line)";
                t.id = item.id + '_help';
                item.appendChild(t);
            }
            function show_user_input(item) {
                x = document.getElementById(item.id + '_opt');
                if (x) item.removeChild(x);
                x = document.getElementById(item.id + '_help');
                if (x) item.removeChild(x);
                t = document.createElement('span');
                t.innerHTML = "(a list of valid users will be proposed)";
                t.id = item.id + '_help';
                item.appendChild(t);
            }
            function init() {
                addProperty('id', '#', 'reserved', '');
                addProperty('ctime', 'Created', 'reserved', '');
                addProperty('mtime', 'Modified', 'reserved', '');
                addProperty('title', 'Description', 'reserved', '');
                addProperty('status', '', 'list', 'open\nclosed\n');
                addProperty('priority', '', 'list', 'high\nmedium\nlow\n');
                addProperty('assignee', '', 'user', '');
                addPredefinedViews('Open issues', 'sort=-mtime&filterin=status:open')
                addPredefinedViews('Closed issues', 'sort=-mtime&filterin=status:closed')
                addPredefinedViews('All issues', 'sort=-mtime')
                //replaceContentInContainer();
            }
            function replaceContentInContainer() {
                matchClass = "updatable";

                var elems = document.getElementsByTagName('*'), i;
                for (i in elems) {
                    if((' ' + elems[i].className + ' ').indexOf(' ' + matchClass + ' ')
                    > -1) {
                        fupdate(elems[i]);
                    }
                }
            }
        </script>
    </head>
    <body onload="init();">
        <div style="float: left; margin:1em;">
            <img src="/public/logo.png" width="120px" alt="Small Issue Tracker Logo">
        </div>
        Logged in as: <span class="sm_username"></span>
        <br>
        <br>
        <br>
        <br>
        <h1>Create new project</h1>
        <form method="POST" action="">
            <div>
                <table>
                    <tr>
                        <td>Project name:</td>
                        <td> <input type="text" size="50" name="name"> </td>
                    </tr>
                    <!--tr style="vertical-align: top;">
                        <td>Description:</td>
                        <td>
                            <textarea name="description" cols="60" rows="10"></textarea>
                        </td>
                    </tr-->
                </table>
            </div>
            <h2>Properties</h2>
            Edit here the properties that you want in your issues.<br>
            Each property has:
            <ul><li>a logical name, that must be unique among the properties of the project. This logical name is used in the address (query string) for filters and sorting.</li>
                <li>a label, that is a more human friendly representation of the property, displayed in the pages. If the label is empty, then the logical name is used instead.</li>
                <li>a type: text, list, multilist, user</li>
                <li>a list of possible values, for list and multilist types</li>
            </ul>
            You cannot use the following names as they are reserved:
            <code>id</code>,
            <code>ctime</code>,
            <code>mtime</code>,
            <code>title</code>
            <br>
            <br>
            <div id="sm_properties"></div>
            <div onclick="addMoreProperties(3);" class="sm_clickable">+ Click for more properties...</div>
            <h2>Predefined views</h2>
            <div id="sm_predefined_views"></div>
            <div onclick="addMorePredefinedViews(3);" class="sm_clickable">+ Click for more...</div>
            <br>

            <input type="submit" value="Apply Configuration">
        </form>
    </body>
</html>
